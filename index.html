<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë„ ë©‹ì§„ ì¹œêµ¬! ìƒ‰ê¹” ì°¾ì•„ì£¼ê¸° ë¹„ë°€ ì‘ì „ (ê°œì„ ë²„ì „)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            flex: 1;
            max-width: 960px;
            margin: 20px auto;
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        header h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2.2em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ì§„í–‰ë¥  í‘œì‹œê¸° */
        .progress-container {
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            border: 2px solid #dee2e6;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 6px;
            transition: width 0.5s ease;
            width: 33.33%;
            position: relative;
        }

        .progress-fill::after {
            content: 'âœ¨';
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            color: #ffd700;
            font-size: 16px;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: translateY(-50%) scale(1); }
            50% { opacity: 0.5; transform: translateY(-50%) scale(1.2); }
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            font-size: 0.95em;
            color: #6c757d;
            gap: 10px;
        }

        .progress-step {
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
            font-weight: 500;
            border: 2px solid transparent;
        }

        .progress-step.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
            border-color: #5a67d8;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .progress-step.completed {
            background-color: #28a745;
            color: white;
            border-color: #20c997;
        }

        /* í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì•ˆë‚´ */
        .keyboard-navigation-info {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border: 2px solid #bee5eb;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9em;
            color: #0c5460;
            margin-bottom: 20px;
            position: relative;
        }

        .keyboard-navigation-info::before {
            content: 'âŒ¨ï¸';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 20px;
        }

        .input-section {
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #fdfdff, #f8f9fa);
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .input-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .input-section h2 {
            font-size: 1.6em;
            color: #2c3e50;
            margin: 0 0 20px 0;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 1.2em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .step1-icon { background: linear-gradient(135deg, #667eea, #764ba2); }
        .step2-icon { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .step3-icon { background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #d35400; }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            font-size: 1em;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .input-group input[type="text"],
        .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ced4da;
            border-radius: 10px;
            font-size: 1em;
            box-sizing: border-box;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-group input[type="text"]:focus,
        .input-group textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            outline: none;
            transform: translateY(-2px);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* ì…ë ¥ ìœ íš¨ì„± í”¼ë“œë°± */
        .input-feedback {
            font-size: 0.85em;
            margin-top: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            display: none;
            font-weight: 500;
        }

        .input-feedback.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .input-feedback.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        /* ì´ë¯¸ì§€ ì—…ë¡œë“œ */
        .image-upload-group {
            margin-top: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #f9f9f9, #f1f3f4);
            border: 3px dashed #ced4da;
            border-radius: 12px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .image-upload-group:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff, #e8f2ff);
        }

        .image-upload-group input[type="file"] {
            display: block;
            margin: 10px auto;
            font-size: 0.9em;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-upload-group input[type="file"]:hover {
            border-color: #667eea;
            background-color: #f8f9ff;
        }

        .image-preview {
            max-width: 250px;
            max-height: 250px;
            margin: 15px auto;
            border: 3px solid #ddd;
            padding: 8px;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .image-preview img {
            max-width: 100%;
            max-height: 230px;
            border-radius: 8px;
        }

        .clear-image-btn {
            font-size: 0.9em;
            padding: 8px 16px;
            margin-top: 10px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .clear-image-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        /* íˆ´íŒ */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip-text {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
            min-width: 150px;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        /* ë„êµ¬ ëª¨ìŒ */
        .toolbar {
            text-align: center;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 2px solid #e0e0e0;
        }

        .toolbar button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 8px;
            border-radius: 10px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
            min-width: 120px;
        }

        .toolbar button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
        }

        .toolbar button.reset {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .toolbar button.reset:hover {
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.3);
        }

        .toolbar button.preview-toggle-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .toolbar button.preview-toggle-btn:hover {
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }

        /* ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ */
        #previewAreaContainer {
            margin-top: 30px;
            padding: 25px;
            border: 3px dashed #bdc3c7;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        #previewAreaContainer h3 {
            text-align: center;
            margin: 0 0 25px 0;
            color: #2c3e50;
            font-size: 1.4em;
        }

        #previewArea {
            border: 2px solid #abb2b9;
            padding: 30px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        #previewArea .info-display {
            font-size: 1em;
            color: #2c3e50;
            padding-bottom: 15px;
            margin-bottom: 20px;
            border-bottom: 2px dashed #ecf0f1;
        }

        #previewArea .phase-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ecf0f1;
        }

        #previewArea .phase-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        #previewArea .phase-section h4 {
            font-size: 1.4em;
            color: #667eea;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #previewArea .phase-section p {
            margin: 10px 0;
            font-size: 1em;
            line-height: 1.7;
            color: #333;
        }

        #previewArea .phase-section strong {
            color: #2c3e50;
            font-weight: 600;
        }

        #previewArea .phase-section .uploaded-image {
            max-width: 200px;
            max-height: 200px;
            margin: 15px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* ë¡œë”© ì¸ë””ì¼€ì´í„° */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 30px 40px;
            border-radius: 15px;
            z-index: 1000;
            font-size: 1.2em;
            font-weight: 500;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
        }

        .loading::before {
            content: 'ğŸ”„';
            display: block;
            font-size: 2em;
            margin-bottom: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ì™„ë£Œ ë©”ì‹œì§€ */
        .completion-message {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 2px solid #28a745;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .completion-message h2 {
            color: #155724;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .completion-message p {
            color: #155724;
            font-size: 1.1em;
            margin-bottom: 25px;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 20px;
            }

            header h1 {
                font-size: 1.8em;
            }

            .progress-steps {
                font-size: 0.8em;
                flex-direction: column;
                gap: 5px;
            }

            .progress-step {
                padding: 6px 10px;
            }

            .navigation-buttons {
                flex-direction: column;
            }

            .toolbar {
                text-align: left;
            }

            .toolbar button {
                display: block;
                width: 100%;
                margin: 5px 0;
            }
        }

        /* ì ‘ê·¼ì„± */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* ê³ ëŒ€ë¹„ ëª¨ë“œ ì§€ì› */
        @media (prefers-contrast: high) {
            .input-group input[type="text"],
            .input-group textarea {
                border-width: 3px;
            }
        }

        /* ëª¨ì…˜ ì¤„ì´ê¸° ì„ í˜¸ ì„¤ì • ì§€ì› */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loadingIndicator" role="status" aria-live="polite">
        <span class="sr-only">ë¡œë”© ì¤‘</span>
        ì²˜ë¦¬ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.
    </div>

    <div class="container">
        <header>
            <h1>ë‚˜ë„ ë©‹ì§„ ì¹œêµ¬! ë‚´ ì¹œêµ¬ì˜ 'ìƒ‰ê¹”'ì„ ì°¾ì•„ì£¼ëŠ” ë¹„ë°€ ì‘ì „! ğŸŒŸ</h1>
        </header>

        <!-- ì§„í–‰ë¥  í‘œì‹œê¸° -->
        <div class="progress-container">
            <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="33">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps">
                <span class="progress-step active" id="step1">ğŸª„ ì‘ì „ 1: ë§ˆë²• ì£¼ë¬¸</span>
                <span class="progress-step" id="step2">ğŸ•µï¸ ì‘ì „ 2: ë¹„ë°€ í–‰ë™</span>
                <span class="progress-step" id="step3">ğŸŒŸ ìµœì¢… ì‘ì „: ë‚˜ì˜ ì•½ì†</span>
            </div>
        </div>

        <!-- í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì•ˆë‚´ -->
        <div class="keyboard-navigation-info">
            ğŸ’¡ <strong>í‚¤ë³´ë“œ ì‚¬ìš©ë²•:</strong> Tab/Shift+Tabìœ¼ë¡œ ì´ë™, Enter/Spaceë¡œ ì„ íƒ, Ctrl+Enterë¡œ ë‹¤ìŒ ë‹¨ê³„ ì´ë™
        </div>

        <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
        <section class="input-section" id="basicInfoSection" role="region" aria-labelledby="basicInfoTitle">
            <h2 id="basicInfoTitle">
                <span class="section-icon step1-icon">ğŸ“‹</span>
                ê¸°ë³¸ ì •ë³´
            </h2>
            <div class="input-group">
                <label for="studentInfo">í•™êµ, í•™ë°˜, ì´ë¦„:</label>
                <input type="text" id="studentInfo" placeholder="ì˜ˆ: OOì´ˆë“±í•™êµ 4í•™ë…„ 2ë°˜ ê¹€ë¯¼ìˆ˜"
                       aria-describedby="studentInfoFeedback" required>
                <div class="input-feedback" id="studentInfoFeedback"></div>
            </div>

            <div class="input-group">
                <div style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); padding: 20px; border-radius: 12px; border-left: 4px solid #667eea;">
                    <div style="display: flex; align-items: start; gap: 15px;">
                        <div style="font-size: 3em;">ğŸ‘¦ğŸ‘§</div>
                        <div>
                            <p style="font-size: 1.1em; color: #2c3e50; margin: 0 0 10px 0;">
                                ê·¸ë¦¼ì±… <strong>'ë³´ì´ì§€ ì•ŠëŠ” ì•„ì´'</strong>ì˜ ë¸Œë¼ì´ì–¸ì€ ì¹œêµ¬ ì €ìŠ¤í‹´ ë•ë¶„ì— ìì‹ ë§Œì˜ ì•„ë¦„ë‹¤ìš´ ìƒ‰ê¹”ì„ ì°¾ì•˜ì–´ìš”!
                            </p>
                            <p style="font-size: 1em; color: #34495e; margin: 0;">
                                ìš°ë¦¬ë„ ì£¼ë³€ ì¹œêµ¬ë“¤ì´ ì•„ì§ ë³´ì—¬ì£¼ì§€ ì•Šì€ ë©‹ì§„ 'ìƒ‰ê¹”'ì„ ë°œê²¬í•˜ê³ , í™œì§ ë¹›ë‚  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ”
                                <strong style="color: #667eea;">'ë¹„ë°€ ìš”ì›'</strong>ì´ ë˜ì–´ íŠ¹ë³„í•œ ì‘ì „ì„ ì‹œì‘í•´ ë³¼ê¹Œìš”?
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ì‘ì „ 1: ë§ˆë²• ì£¼ë¬¸ -->
        <section id="magicWordsSection" class="input-section" role="region" aria-labelledby="magicTitle">
            <h2 id="magicTitle">
                <span class="section-icon step1-icon">ğŸª„</span>
                ì‘ì „ 1: ì¹œêµ¬ì—ê²Œ í˜ì„ ì£¼ëŠ” 'ë§ˆë²• ì£¼ë¬¸' (ë§) âœï¸
            </h2>

            <div style="background: linear-gradient(135deg, #f0f4ff, #e8f2ff); padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                <p style="font-size: 1.1em; color: #2c3e50; margin: 0 0 15px 0;">
                    ì¹œêµ¬ê°€ ê¸°ìš´ì„ ë‚´ê³  í™œì§ ì›ƒì„ ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” 'ë§ˆë²• ì£¼ë¬¸' ê°™ì€ ë§ì„ 3ê°€ì§€ ìƒê°í•´ ì ì–´ë³´ì„¸ìš”.
                    ì–´ë–¤ ë§ì„ í•´ì£¼ë©´ ì¹œêµ¬ì˜ ë§ˆìŒì†ì— ì˜ˆìœ ìƒ‰ê¹”ì´ í”¼ì–´ë‚ ê¹Œìš”?
                </p>

                <div class="tooltip">
                    <span style="color: #667eea; cursor: help; border-bottom: 2px dotted #667eea; font-weight: 600;">
                        ğŸ’¡ íŒíŠ¸ê°€ í•„ìš”í•˜ë‹¤ë©´ ì—¬ê¸°ë¥¼ ë³´ì„¸ìš”!
                    </span>
                    <div class="tooltip-text">
                        ì˜ˆ: 'ë„¤ ìƒê° ì •ë§ ë©‹ì§€ë‹¤!', 'ë„ˆë‘ ê°™ì´ ìˆìœ¼ë©´ í•­ìƒ ì¦ê±°ì›Œ!', 'ê´œì°®ì•„, ë‚´ê°€ ì˜†ì— ìˆì„ê²Œ!'
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label for="magicWord1">ë§ˆë²• ì£¼ë¬¸ 1:</label>
                <input type="text" id="magicWord1" placeholder="ì¹œêµ¬ì—ê²Œ í˜ì„ ì£¼ëŠ” ë”°ëœ»í•œ ë§ì„ ì ì–´ë³´ì„¸ìš”..."
                       aria-describedby="magicWord1Feedback" maxlength="50">
                <div class="input-feedback" id="magicWord1Feedback"></div>
            </div>

            <div class="input-group">
                <label for="magicWord2">ë§ˆë²• ì£¼ë¬¸ 2:</label>
                <input type="text" id="magicWord2" placeholder="ë˜ ë‹¤ë¥¸ ë§ˆë²• ì£¼ë¬¸ì„ ìƒê°í•´ë³´ì„¸ìš”..."
                       aria-describedby="magicWord2Feedback" maxlength="50">
                <div class="input-feedback" id="magicWord2Feedback"></div>
            </div>

            <div class="input-group">
                <label for="magicWord3">ë§ˆë²• ì£¼ë¬¸ 3:</label>
                <input type="text" id="magicWord3" placeholder="ì„¸ ë²ˆì§¸ ë§ˆë²• ì£¼ë¬¸ì„ ì ì–´ë³´ì„¸ìš”..."
                       aria-describedby="magicWord3Feedback" maxlength="50">
                <div class="input-feedback" id="magicWord3Feedback"></div>
            </div>

            <div class="input-group">
                <label for="magicWordImage">ğŸ¨ ë§ˆë²• ì£¼ë¬¸ì„ í‘œí˜„í•˜ëŠ” ê·¸ë¦¼ì´ë‚˜ ì‚¬ì§„ (ì„ íƒì‚¬í•­):</label>
                <div class="image-upload-group">
                    <p style="color: #6c757d; margin: 0 0 10px 0;">
                        ğŸ“¸ ì¹œêµ¬ì—ê²Œ í˜ì„ ì£¼ëŠ” ë§ˆë²• ì£¼ë¬¸ì„ ê·¸ë¦¼ìœ¼ë¡œ ê·¸ë¦¬ê±°ë‚˜ ê´€ë ¨ ì‚¬ì§„ì„ ì˜¬ë ¤ë³´ì„¸ìš”!
                    </p>
                    <input type="file" id="magicWordImageUpload" accept="image/*" aria-describedby="magicWordImageHelp">
                    <div id="magicWordImageHelp" class="sr-only">ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                    <div class="image-preview" id="magicWordImagePreviewContainer" style="display:none;" role="img" aria-label="ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
                        <img id="magicWordImagePreview" src="#" alt="ë§ˆë²• ì£¼ë¬¸ ê´€ë ¨ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
                    </div>
                    <button type="button" id="clearMagicWordImageBtn" class="clear-image-btn" style="display:none;" aria-label="ì²¨ë¶€ëœ ì´ë¯¸ì§€ ì‚­ì œ">
                        ì²¨ë¶€ ì´ë¯¸ì§€ ì§€ìš°ê¸°
                    </button>
                </div>
            </div>

            <div class="navigation-buttons">
                <button type="button" id="magicToSecretBtn" class="action-btn" aria-label="2ë‹¨ê³„ë¡œ ì´ë™: ë¹„ë°€ í–‰ë™">
                    ë‹¤ìŒ ì‘ì „ (ë¹„ë°€ í–‰ë™) ğŸ•µï¸
                </button>
            </div>
        </section>

        <!-- ì‘ì „ 2: ë¹„ë°€ í–‰ë™ -->
        <section id="secretActionsSection" class="input-section" style="display:none;" role="region" aria-labelledby="secretTitle">
            <h2 id="secretTitle">
                <span class="section-icon step2-icon">ğŸ•µï¸</span>
                ì‘ì „ 2: ì¹œêµ¬ë¥¼ ì›ƒê²Œ í•˜ëŠ” 'ë¹„ë°€ í–‰ë™' (í–‰ë™) ğŸƒâ€â™‚ï¸ğŸ’¨
            </h2>

            <div style="background: linear-gradient(135deg, #e8f5e8, #f0fff0); padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                <p style="font-size: 1.1em; color: #2c3e50; margin: 0 0 15px 0;">
                    ë§ë¿ë§Œ ì•„ë‹ˆë¼, ì–´ë–¤ 'ë¹„ë°€ í–‰ë™'ìœ¼ë¡œ ì¹œêµ¬ë¥¼ ê¸°ë¶„ ì¢‹ê²Œ í•˜ê³  ê·¸ ì¹œêµ¬ë§Œì˜ íŠ¹ë³„í•œ ìƒ‰ê¹”ì„ ì°¾ì•„ì¤„ ìˆ˜ ìˆì„ê¹Œìš”?
                    ë‚˜ë§Œì˜ íŠ¹ë³„í•œ í–‰ë™ 3ê°€ì§€ë¥¼ ì ì–´ë³´ì„¸ìš”.
                </p>

                <div class="tooltip">
                    <span style="color: #11998e; cursor: help; border-bottom: 2px dotted #11998e; font-weight: 600;">
                        ğŸ’¡ íŒíŠ¸ê°€ í•„ìš”í•˜ë‹¤ë©´ ì—¬ê¸°ë¥¼ ë³´ì„¸ìš”!
                    </span>
                    <div class="tooltip-text">
                        ì˜ˆ: ë¨¼ì € ë‹¤ê°€ê°€ ì›ƒìœ¼ë©° ì¸ì‚¬í•˜ê¸°, ë„ì›€ì´ í•„ìš”í•´ ë³´ì¼ ë•Œ ìŠ¬ì© ë„ì™€ì£¼ê¸°, í•¨ê»˜ ì¬ë¯¸ìˆëŠ” ë†€ì´í•˜ê¸°
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label for="secretAction1">ë¹„ë°€ í–‰ë™ 1:</label>
                <input type="text" id="secretAction1" placeholder="ì¹œêµ¬ë¥¼ ê¸°ë¶„ ì¢‹ê²Œ í•˜ëŠ” í–‰ë™ì„ ì ì–´ë³´ì„¸ìš”..."
                       aria-describedby="secretAction1Feedback" maxlength="50">
                <div class="input-feedback" id="secretAction1Feedback"></div>
            </div>

            <div class="input-group">
                <label for="secretAction2">ë¹„ë°€ í–‰ë™ 2:</label>
                <input type="text" id="secretAction2" placeholder="ë˜ ë‹¤ë¥¸ ë¹„ë°€ í–‰ë™ì„ ìƒê°í•´ë³´ì„¸ìš”..."
                       aria-describedby="secretAction2Feedback" maxlength="50">
                <div class="input-feedback" id="secretAction2Feedback"></div>
            </div>

            <div class="input-group">
                <label for="secretAction3">ë¹„ë°€ í–‰ë™ 3:</label>
                <input type="text" id="secretAction3" placeholder="ì„¸ ë²ˆì§¸ ë¹„ë°€ í–‰ë™ì„ ì ì–´ë³´ì„¸ìš”..."
                       aria-describedby="secretAction3Feedback" maxlength="50">
                <div class="input-feedback" id="secretAction3Feedback"></div>
            </div>

            <div class="input-group">
                <label for="secretActionImage">ğŸ¨ ë¹„ë°€ í–‰ë™ì„ í‘œí˜„í•˜ëŠ” ê·¸ë¦¼ì´ë‚˜ ì‚¬ì§„ (ì„ íƒì‚¬í•­):</label>
                <div class="image-upload-group">
                    <p style="color: #6c757d; margin: 0 0 10px 0;">
                        ğŸ“¸ ì¹œêµ¬ë¥¼ ì›ƒê²Œ í•˜ëŠ” ë¹„ë°€ í–‰ë™ì„ ê·¸ë¦¼ìœ¼ë¡œ ê·¸ë¦¬ê±°ë‚˜ ê´€ë ¨ ì‚¬ì§„ì„ ì˜¬ë ¤ë³´ì„¸ìš”!
                    </p>
                    <input type="file" id="secretActionImageUpload" accept="image/*" aria-describedby="secretActionImageHelp">
                    <div id="secretActionImageHelp" class="sr-only">ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                    <div class="image-preview" id="secretActionImagePreviewContainer" style="display:none;" role="img" aria-label="ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
                        <img id="secretActionImagePreview" src="#" alt="ë¹„ë°€ í–‰ë™ ê´€ë ¨ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
                    </div>
                    <button type="button" id="clearSecretActionImageBtn" class="clear-image-btn" style="display:none;" aria-label="ì²¨ë¶€ëœ ì´ë¯¸ì§€ ì‚­ì œ">
                        ì²¨ë¶€ ì´ë¯¸ì§€ ì§€ìš°ê¸°
                    </button>
                </div>
            </div>

            <div class="navigation-buttons">
                <button type="button" id="secretToMagicBtn" class="action-btn" aria-label="1ë‹¨ê³„ë¡œ ëŒì•„ê°€ê¸°: ë§ˆë²• ì£¼ë¬¸">
                    ì´ì „ ì‘ì „ (ë§ˆë²• ì£¼ë¬¸) ğŸª„
                </button>
                <button type="button" id="secretToPromiseBtn" class="action-btn" aria-label="3ë‹¨ê³„ë¡œ ì´ë™: ë‚˜ì˜ ì•½ì†">
                    ìµœì¢… ì‘ì „ (ë‚˜ì˜ ì•½ì†) ğŸŒŸ
                </button>
            </div>
        </section>

        <!-- ì‘ì „ 3: ìµœì¢… ì•½ì† -->
        <section id="finalPromiseSection" class="input-section" style="display:none;" role="region" aria-labelledby="promiseTitle">
            <h2 id="promiseTitle">
                <span class="section-icon step3-icon">ğŸŒŸ</span>
                ìµœì¢… ì‘ì „: ë‚˜ì˜ ë¹›ë‚˜ëŠ” 'ìƒ‰ê¹” ì°¾ì•„ì£¼ê¸°' ì•½ì†! ğŸŒŸ
            </h2>

            <div style="background: linear-gradient(135deg, #fff3e0, #ffeaa7); padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                <p style="font-size: 1.1em; color: #2c3e50; margin: 0;">
                    ì´ì œ ìœ„ì—ì„œ ìƒê°í•œ ë§ˆë²• ì£¼ë¬¸ê³¼ ë¹„ë°€ í–‰ë™ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ, ì•ìœ¼ë¡œ ì¹œêµ¬ì˜ 'ìƒ‰ê¹”'ì„ ì°¾ì•„ì£¼ê¸° ìœ„í•´
                    ë‚´ê°€ ê¼­ ì‹¤ì²œí•˜ê³  ì‹¶ì€ ê°€ì¥ ì¤‘ìš”í•œ ì•½ì† í•œ ê°€ì§€ë¥¼ ì •í•´ì„œ ì ì–´ì£¼ì„¸ìš”!
                </p>
            </div>

            <!-- ìš”ì•½ ì˜ì—­ -->
            <div id="summaryArea" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                <h4 style="color: #2c3e50; margin: 0 0 15px 0; text-align: center;">ğŸ“ ë‚´ê°€ ìƒê°í•œ ì‘ì „ë“¤ ìš”ì•½</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #667eea;">
                        <strong style="color: #667eea;">ğŸª„ ë§ˆë²• ì£¼ë¬¸ë“¤</strong>
                        <p id="summaryMagicWords" style="margin: 10px 0 0 0; font-size: 0.9em; color: #555;"></p>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #11998e;">
                        <strong style="color: #11998e;">ğŸ•µï¸ ë¹„ë°€ í–‰ë™ë“¤</strong>
                        <p id="summarySecretActions" style="margin: 10px 0 0 0; font-size: 0.9em; color: #555;"></p>
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label for="finalPromise">ë‚˜ì˜ ì†Œì¤‘í•œ ì•½ì†:</label>
                <div style="background: linear-gradient(135deg, #fef7cd, #fff8dc); border: 3px solid #d4a574; border-radius: 15px; padding: 20px; position: relative;">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <span style="font-size: 1.2em; color: #8b4513; font-weight: bold;">ğŸ“œ ë‚˜ì˜ ì†Œì¤‘í•œ ì•½ì†ì„œ ğŸ“œ</span>
                    </div>
                    <textarea id="finalPromise" placeholder="ì¹œêµ¬ì˜ ìƒ‰ê¹”ì„ ì°¾ì•„ì£¼ê¸° ìœ„í•´ ë‚´ê°€ ê¼­ ì‹¤ì²œí•˜ê³  ì‹¶ì€ ì•½ì†ì„ ì ì–´ì£¼ì„¸ìš”..."
                              rows="5" style="background: rgba(255,255,255,0.9); border: 2px solid #d4a574;"
                              aria-describedby="finalPromiseFeedback" maxlength="200"></textarea>
                    <div class="input-feedback" id="finalPromiseFeedback"></div>
                </div>
            </div>

            <div class="input-group">
                <label for="promiseImage">ğŸ¨ ë‚˜ì˜ ì•½ì†ì„ í‘œí˜„í•˜ëŠ” ê·¸ë¦¼ì´ë‚˜ ì‚¬ì§„ (ì„ íƒì‚¬í•­):</label>
                <div class="image-upload-group">
                    <p style="color: #6c757d; margin: 0 0 10px 0;">
                        ğŸ“¸ ë‚˜ì˜ ì†Œì¤‘í•œ ì•½ì†ì„ ê·¸ë¦¼ìœ¼ë¡œ ê·¸ë¦¬ê±°ë‚˜ ê´€ë ¨ ì‚¬ì§„ì„ ì˜¬ë ¤ë³´ì„¸ìš”!
                    </p>
                    <input type="file" id="promiseImageUpload" accept="image/*" aria-describedby="promiseImageHelp">
                    <div id="promiseImageHelp" class="sr-only">ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                    <div class="image-preview" id="promiseImagePreviewContainer" style="display:none;" role="img" aria-label="ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
                        <img id="promiseImagePreview" src="#" alt="ì•½ì† ê´€ë ¨ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
                    </div>
                    <button type="button" id="clearPromiseImageBtn" class="clear-image-btn" style="display:none;" aria-label="ì²¨ë¶€ëœ ì´ë¯¸ì§€ ì‚­ì œ">
                        ì²¨ë¶€ ì´ë¯¸ì§€ ì§€ìš°ê¸°
                    </button>
                </div>
            </div>

            <div class="navigation-buttons">
                <button type="button" id="promiseToSecretBtn" class="action-btn" aria-label="2ë‹¨ê³„ë¡œ ëŒì•„ê°€ê¸°: ë¹„ë°€ í–‰ë™">
                    ì´ì „ ì‘ì „ (ë¹„ë°€ í–‰ë™) ğŸ•µï¸
                </button>
                <button type="button" id="completeBtn" class="action-btn" style="background: linear-gradient(135deg, #f39c12, #e67e22);" aria-label="ë¹„ë°€ ì‘ì „ ì™„ë£Œ">
                    ğŸ‰ ë¹„ë°€ ì‘ì „ ì™„ë£Œ! ğŸ‰
                </button>
            </div>
        </section>

        <!-- ì™„ë£Œ ë©”ì‹œì§€ -->
        <div id="completionMessage" class="completion-message" style="display:none;">
            <div style="font-size: 4em; margin-bottom: 20px;">ğŸŠâœ¨ğŸŒŸ</div>
            <h2>ì¶•í•˜í•´ìš”! ğŸ‰</h2>
            <p>
                ì¹œêµ¬ì˜ ìƒ‰ê¹”ì„ ì°¾ì•„ì£¼ëŠ” ë©‹ì§„ <strong style="color: #667eea;">ë¹„ë°€ ìš”ì›</strong>ì´ ë˜ì—ˆì–´ìš”!<br>
                ë‹¹ì‹ ì˜ ë”°ëœ»í•œ ë§ˆìŒì´ ì¹œêµ¬ë“¤ì—ê²Œ ì˜ ì „ë‹¬ë  ê±°ì˜ˆìš”.
            </p>
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button id="printBtn" class="action-btn" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                    ğŸ“„ ë‚˜ì˜ ì•½ì† ì¹´ë“œ ì¸ì‡„í•˜ê¸°
                </button>
                <button id="newMissionBtn" class="action-btn" style="background: linear-gradient(135deg, #95a5a6, #7f8c8d);">
                    ğŸ”„ ìƒˆë¡œìš´ ì‘ì „ ì‹œì‘í•˜ê¸°
                </button>
            </div>
        </div>

        <!-- ë„êµ¬ ëª¨ìŒ -->
        <div class="toolbar" role="toolbar" aria-label="í•™ìŠµì§€ ë„êµ¬">
            <button id="togglePreviewBtn" class="preview-toggle-btn" aria-label="ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ/ìˆ¨ê¸°ê¸°">
                ğŸ“‹ ë¯¸ë¦¬ë³´ê¸° ë³´ê¸°/ìˆ¨ê¸°ê¸°
            </button>
            <button id="saveAsImageBtn" aria-label="ì™„ì„±ëœ í•™ìŠµì§€ë¥¼ ì´ë¯¸ì§€ íŒŒì¼ë¡œ ì €ì¥">
                ğŸ–¼ï¸ ì´ë¯¸ì§€ë¡œ ì €ì¥
            </button>
            <button id="saveAsPdfBtn" aria-label="ì™„ì„±ëœ í•™ìŠµì§€ë¥¼ PDF íŒŒì¼ë¡œ ì €ì¥">
                ğŸ“„ PDFë¡œ ì €ì¥
            </button>
            <button id="resetBtn" class="reset" aria-label="ëª¨ë“  ì…ë ¥ ë‚´ìš© ì´ˆê¸°í™”">
                ğŸ†• ìƒˆë¡œ ì‘ì„±
            </button>
        </div>

        <!-- ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
        <div id="previewAreaContainer" style="display:none;" role="region" aria-labelledby="previewTitle">
            <h3 id="previewTitle">ğŸ“‹ ë¯¸ë¦¬ë³´ê¸° (ì´ ì˜ì—­ì´ ì´ë¯¸ì§€/PDFë¡œ ì €ì¥ë©ë‹ˆë‹¤)</h3>
            <div id="previewArea">
                <div class="info-display">
                    <p><strong>í•™êµ, í•™ë°˜, ì´ë¦„:</strong> <span id="previewStudentInfo"></span></p>
                </div>

                <div class="phase-section">
                    <h4>ğŸª„ ì¹œêµ¬ì—ê²Œ í˜ì„ ì£¼ëŠ” ë§ˆë²• ì£¼ë¬¸</h4>
                    <p><strong>ë§ˆë²• ì£¼ë¬¸ 1:</strong> <span id="previewMagicWord1"></span></p>
                    <p><strong>ë§ˆë²• ì£¼ë¬¸ 2:</strong> <span id="previewMagicWord2"></span></p>
                    <p><strong>ë§ˆë²• ì£¼ë¬¸ 3:</strong> <span id="previewMagicWord3"></span></p>
                    <img id="previewMagicWordImage" src="#" alt="ë§ˆë²• ì£¼ë¬¸ ê´€ë ¨ ì´ë¯¸ì§€" class="uploaded-image" style="display: none;">
                </div>

                <div class="phase-section">
                    <h4>ğŸ•µï¸ ì¹œêµ¬ë¥¼ ì›ƒê²Œ í•˜ëŠ” ë¹„ë°€ í–‰ë™</h4>
                    <p><strong>ë¹„ë°€ í–‰ë™ 1:</strong> <span id="previewSecretAction1"></span></p>
                    <p><strong>ë¹„ë°€ í–‰ë™ 2:</strong> <span id="previewSecretAction2"></span></p>
                    <p><strong>ë¹„ë°€ í–‰ë™ 3:</strong> <span id="previewSecretAction3"></span></p>
                    <img id="previewSecretActionImage" src="#" alt="ë¹„ë°€ í–‰ë™ ê´€ë ¨ ì´ë¯¸ì§€" class="uploaded-image" style="display: none;">
                </div>

                <div class="phase-section">
                    <h4>ğŸŒŸ ë‚˜ì˜ ì†Œì¤‘í•œ ì•½ì†</h4>
                    <div style="background: linear-gradient(135deg, #fef7cd, #fff8dc); border: 2px solid #d4a574; border-radius: 10px; padding: 20px; margin: 15px 0;">
                        <p id="previewFinalPromise" style="font-size: 1.1em; font-weight: 500; line-height: 1.8; color: #8b4513; margin: 0;"></p>
                    </div>
                    <img id="previewPromiseImage" src="#" alt="ì•½ì† ê´€ë ¨ ì´ë¯¸ì§€" class="uploaded-image" style="display: none;">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        class FriendshipMissionApp {
            constructor() {
                this.currentStep = 1;
                this.appState = {
                    studentInfo: '',
                    magicWords: ['', '', ''],
                    secretActions: ['', '', ''],
                    finalPromise: '',
                    images: {
                        magicWord: null,
                        secretAction: null,
                        promise: null
                    }
                };

                this.initializeElements();
                this.setupEventListeners();
                this.setupKeyboardNavigation();
                this.updateProgress();
                this.loadSavedData();
            }

            initializeElements() {
                // ê¸°ë³¸ ì •ë³´ ìš”ì†Œë“¤
                this.elements = {
                    studentInfo: document.getElementById('studentInfo'),
                    
                    // ë§ˆë²• ì£¼ë¬¸ ìš”ì†Œë“¤
                    magicWord1: document.getElementById('magicWord1'),
                    magicWord2: document.getElementById('magicWord2'),
                    magicWord3: document.getElementById('magicWord3'),
                    magicWordImageUpload: document.getElementById('magicWordImageUpload'),
                    magicWordImagePreview: document.getElementById('magicWordImagePreview'),
                    magicWordImagePreviewContainer: document.getElementById('magicWordImagePreviewContainer'),
                    clearMagicWordImageBtn: document.getElementById('clearMagicWordImageBtn'),
                    
                    // ë¹„ë°€ í–‰ë™ ìš”ì†Œë“¤
                    secretAction1: document.getElementById('secretAction1'),
                    secretAction2: document.getElementById('secretAction2'),
                    secretAction3: document.getElementById('secretAction3'),
                    secretActionImageUpload: document.getElementById('secretActionImageUpload'),
                    secretActionImagePreview: document.getElementById('secretActionImagePreview'),
                    secretActionImagePreviewContainer: document.getElementById('secretActionImagePreviewContainer'),
                    clearSecretActionImageBtn: document.getElementById('clearSecretActionImageBtn'),
                    
                    // ìµœì¢… ì•½ì† ìš”ì†Œë“¤
                    finalPromise: document.getElementById('finalPromise'),
                    promiseImageUpload: document.getElementById('promiseImageUpload'),
                    promiseImagePreview: document.getElementById('promiseImagePreview'),
                    promiseImagePreviewContainer: document.getElementById('promiseImagePreviewContainer'),
                    clearPromiseImageBtn: document.getElementById('clearPromiseImageBtn'),
                    
                    // ì§„í–‰ë¥  ë° ë¯¸ë¦¬ë³´ê¸° ìš”ì†Œë“¤
                    progressFill: document.getElementById('progressFill'),
                    step1: document.getElementById('step1'),
                    step2: document.getElementById('step2'),
                    step3: document.getElementById('step3'),
                    previewAreaContainer: document.getElementById('previewAreaContainer'),
                    previewArea: document.getElementById('previewArea'),
                    loadingIndicator: document.getElementById('loadingIndicator')
                };

                this.sections = {
                    basic: document.getElementById('basicInfoSection'),
                    magic: document.getElementById('magicWordsSection'),
                    secret: document.getElementById('secretActionsSection'),
                    promise: document.getElementById('finalPromiseSection')
                };

                this.buttons = {
                    magicToSecret: document.getElementById('magicToSecretBtn'),
                    secretToMagic: document.getElementById('secretToMagicBtn'),
                    secretToPromise: document.getElementById('secretToPromiseBtn'),
                    promiseToSecret: document.getElementById('promiseToSecretBtn'),
                    complete: document.getElementById('completeBtn'),
                    togglePreview: document.getElementById('togglePreviewBtn'),
                    saveAsImage: document.getElementById('saveAsImageBtn'),
                    saveAsPdf: document.getElementById('saveAsPdfBtn'),
                    reset: document.getElementById('resetBtn'),
                    print: document.getElementById('printBtn'),
                    newMission: document.getElementById('newMissionBtn')
                };
            }

            setupEventListeners() {
                // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ë“¤
                this.buttons.magicToSecret.addEventListener('click', () => this.goToStep(2));
                this.buttons.secretToMagic.addEventListener('click', () => this.goToStep(1));
                this.buttons.secretToPromise.addEventListener('click', () => this.goToStep(3));
                this.buttons.promiseToSecret.addEventListener('click', () => this.goToStep(2));
                this.buttons.complete.addEventListener('click', () => this.completeMission());

                // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì´ë²¤íŠ¸ë“¤
                this.elements.magicWordImageUpload.addEventListener('change', (e) => 
                    this.handleImageUpload(e, 'magicWord'));
                this.elements.secretActionImageUpload.addEventListener('change', (e) => 
                    this.handleImageUpload(e, 'secretAction'));
                this.elements.promiseImageUpload.addEventListener('change', (e) => 
                    this.handleImageUpload(e, 'promise'));

                // ì´ë¯¸ì§€ ì‚­ì œ ë²„íŠ¼ë“¤
                this.elements.clearMagicWordImageBtn.addEventListener('click', () => 
                    this.clearImage('magicWord'));
                this.elements.clearSecretActionImageBtn.addEventListener('click', () => 
                    this.clearImage('secretAction'));
                this.elements.clearPromiseImageBtn.addEventListener('click', () => 
                    this.clearImage('promise'));

                // ë„êµ¬ ë²„íŠ¼ë“¤
                this.buttons.togglePreview.addEventListener('click', () => this.togglePreview());
                this.buttons.saveAsImage.addEventListener('click', () => this.saveAsImage());
                this.buttons.saveAsPdf.addEventListener('click', () => this.saveAsPdf());
                this.buttons.reset.addEventListener('click', () => this.resetAll());
                this.buttons.print.addEventListener('click', () => this.printCard());
                this.buttons.newMission.addEventListener('click', () => this.resetAll());

                // ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬
                this.setupValidation();

                // ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
                this.setupRealTimeUpdates();
            }

            setupValidation() {
                const validationRules = [
                    { element: this.elements.studentInfo, feedback: 'studentInfoFeedback', required: true },
                    { element: this.elements.magicWord1, feedback: 'magicWord1Feedback', required: true },
                    { element: this.elements.magicWord2, feedback: 'magicWord2Feedback', required: true },
                    { element: this.elements.magicWord3, feedback: 'magicWord3Feedback', required: true },
                    { element: this.elements.secretAction1, feedback: 'secretAction1Feedback', required: true },
                    { element: this.elements.secretAction2, feedback: 'secretAction2Feedback', required: true },
                    { element: this.elements.secretAction3, feedback: 'secretAction3Feedback', required: true },
                    { element: this.elements.finalPromise, feedback: 'finalPromiseFeedback', required: true }
                ];

                validationRules.forEach(rule => {
                    rule.element.addEventListener('blur', () => 
                        this.validateInput(rule.element, rule.feedback, rule.required));
                    rule.element.addEventListener('input', () => 
                        this.clearFeedback(rule.feedback));
                });
            }

            validateInput(element, feedbackId, required = true) {
                const feedback = document.getElementById(feedbackId);
                const value = element.value.trim();
                
                if (required && value.length === 0) {
                    this.showFeedback(feedback, 'í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.', 'error');
                    return false;
                } else if (required && value.length < 2) {
                    this.showFeedback(feedback, 'ìµœì†Œ 2ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                    return false;
                } else if (value.length > 0) {
                    this.showFeedback(feedback, 'ì…ë ¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨', 'success');
                    return true;
                }
                return true;
            }

            showFeedback(feedbackElement, message, type) {
                feedbackElement.textContent = message;
                feedbackElement.className = `input-feedback ${type}`;
                feedbackElement.style.display = 'block';
                
                if (type === 'success') {
                    setTimeout(() => {
                        feedbackElement.style.display = 'none';
                    }, 3000);
                }
            }

            clearFeedback(feedbackId) {
                const feedback = document.getElementById(feedbackId);
                feedback.style.display = 'none';
            }

            setupRealTimeUpdates() {
                const inputs = [
                    this.elements.studentInfo,
                    this.elements.magicWord1, this.elements.magicWord2, this.elements.magicWord3,
                    this.elements.secretAction1, this.elements.secretAction2, this.elements.secretAction3,
                    this.elements.finalPromise
                ];

                inputs.forEach(input => {
                    input.addEventListener('input', () => {
                        this.updateAppState();
                        this.saveData();
                    });
                });
            }

            setupKeyboardNavigation() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        e.preventDefault();
                        if (this.currentStep < 3) {
                            this.goToStep(this.currentStep + 1);
                        } else {
                            this.completeMission();
                        }
                    }
                    
                    if (e.ctrlKey && e.shiftKey && e.key === 'Enter') {
                        e.preventDefault();
                        if (this.currentStep > 1) {
                            this.goToStep(this.currentStep - 1);
                        }
                    }
                });
            }

            updateAppState() {
                this.appState.studentInfo = this.elements.studentInfo.value;
                
                this.appState.magicWords = [
                    this.elements.magicWord1.value,
                    this.elements.magicWord2.value,
                    this.elements.magicWord3.value
                ];
                
                this.appState.secretActions = [
                    this.elements.secretAction1.value,
                    this.elements.secretAction2.value,
                    this.elements.secretAction3.value
                ];
                
                this.appState.finalPromise = this.elements.finalPromise.value;
            }

            handleImageUpload(event, imageType) {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('ì´ë¯¸ì§€ íŒŒì¼ì€ 5MB ì´í•˜ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                        event.target.value = '';
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.appState.images[imageType] = e.target.result;
                        this.updateImagePreview(imageType, e.target.result);
                        this.saveData();
                    };
                    reader.readAsDataURL(file);
                } else {
                    this.clearImage(imageType);
                }
            }

            updateImagePreview(imageType, imageData) {
                const preview = this.elements[`${imageType}ImagePreview`];
                const container = this.elements[`${imageType}ImagePreviewContainer`];
                const clearBtn = this.elements[`clear${imageType.charAt(0).toUpperCase() + imageType.slice(1)}ImageBtn`];
                
                preview.src = imageData;
                container.style.display = 'flex';
                clearBtn.style.display = 'inline-block';
            }

            clearImage(imageType) {
                const preview = this.elements[`${imageType}ImagePreview`];
                const container = this.elements[`${imageType}ImagePreviewContainer`];
                const clearBtn = this.elements[`clear${imageType.charAt(0).toUpperCase() + imageType.slice(1)}ImageBtn`];
                const upload = this.elements[`${imageType}ImageUpload`];
                
                preview.src = '#';
                container.style.display = 'none';
                clearBtn.style.display = 'none';
                upload.value = '';
                this.appState.images[imageType] = null;
                this.saveData();
            }

            goToStep(step) {
                this.currentStep = step;
                this.updateProgress();
                
                // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                Object.values(this.sections).forEach(section => {
                    section.style.display = 'none';
                });
                
                // í˜„ì¬ ë‹¨ê³„ ì„¹ì…˜ë§Œ í‘œì‹œ
                switch(step) {
                    case 1:
                        this.sections.basic.style.display = 'block';
                        this.sections.magic.style.display = 'block';
                        break;
                    case 2:
                        this.sections.secret.style.display = 'block';
                        break;
                    case 3:
                        this.updateSummary();
                        this.sections.promise.style.display = 'block';
                        break;
                }
                
                // í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                const targetSection = step === 1 ? this.sections.magic : 
                                   step === 2 ? this.sections.secret : this.sections.promise;
                
                setTimeout(() => {
                    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    
                    // ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
                    const firstInput = targetSection.querySelector('input, textarea');
                    if (firstInput) {
                        firstInput.focus();
                    }
                }, 300);
            }

            updateProgress() {
                const progressPercent = (this.currentStep / 3) * 100;
                this.elements.progressFill.style.width = `${progressPercent}%`;
                
                const progressBar = document.querySelector('.progress-bar');
                progressBar.setAttribute('aria-valuenow', progressPercent);
                
                [this.elements.step1, this.elements.step2, this.elements.step3].forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    if (index + 1 === this.currentStep) {
                        step.classList.add('active');
                    } else if (index + 1 < this.currentStep) {
                        step.classList.add('completed');
                    }
                });
            }

            updateSummary() {
                this.updateAppState();
                
                const magicWords = this.appState.magicWords.filter(word => word.trim()).join(', ') || 'ì•„ì§ ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                const secretActions = this.appState.secretActions.filter(action => action.trim()).join(', ') || 'ì•„ì§ ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                
                document.getElementById('summaryMagicWords').textContent = magicWords;
                document.getElementById('summarySecretActions').textContent = secretActions;
            }

            completeMission() {
                this.updateAppState();
                
                // í•„ìˆ˜ ì…ë ¥ í™•ì¸
                const requiredFields = [
                    { value: this.appState.studentInfo, name: 'í•™ìƒ ì •ë³´' },
                    { value: this.appState.magicWords[0], name: 'ë§ˆë²• ì£¼ë¬¸ 1' },
                    { value: this.appState.magicWords[1], name: 'ë§ˆë²• ì£¼ë¬¸ 2' },
                    { value: this.appState.magicWords[2], name: 'ë§ˆë²• ì£¼ë¬¸ 3' },
                    { value: this.appState.secretActions[0], name: 'ë¹„ë°€ í–‰ë™ 1' },
                    { value: this.appState.secretActions[1], name: 'ë¹„ë°€ í–‰ë™ 2' },
                    { value: this.appState.secretActions[2], name: 'ë¹„ë°€ í–‰ë™ 3' },
                    { value: this.appState.finalPromise, name: 'ìµœì¢… ì•½ì†' }
                ];
                
                const missingFields = requiredFields.filter(field => !field.value.trim());
                
                if (missingFields.length > 0) {
                    alert(`ë‹¤ìŒ í•­ëª©ë“¤ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:\n${missingFields.map(field => field.name).join('\n')}`);
                    return;
                }
                
                // ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
                document.getElementById('completionMessage').style.display = 'block';
                document.getElementById('completionMessage').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
                
                this.createSparkleEffect();
            }

            createSparkleEffect() {
                const sparkles = ['âœ¨', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'ğŸŠ'];
                const container = document.body;
                
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const sparkle = document.createElement('div');
                        sparkle.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
                        sparkle.style.position = 'fixed';
                        sparkle.style.left = Math.random() * window.innerWidth + 'px';
                        sparkle.style.top = Math.random() * window.innerHeight + 'px';
                        sparkle.style.fontSize = '2em';
                        sparkle.style.zIndex = '9999';
                        sparkle.style.pointerEvents = 'none';
                        sparkle.style.animation = 'sparkleFloat 3s ease-out forwards';
                        
                        container.appendChild(sparkle);
                        
                        setTimeout(() => {
                            if (sparkle.parentNode) {
                                sparkle.parentNode.removeChild(sparkle);
                            }
                        }, 3000);
                    }, i * 100);
                }
                
                // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
                if (!document.querySelector('#sparkleAnimation')) {
                    const style = document.createElement('style');
                    style.id = 'sparkleAnimation';
                    style.textContent = `
                        @keyframes sparkleFloat {
                            0% { opacity: 1; transform: translateY(0px) scale(0); }
                            50% { opacity: 1; transform: translateY(-100px) scale(1.2); }
                            100% { opacity: 0; transform: translateY(-200px) scale(0); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }

            updatePreview() {
                this.updateAppState();
                
                // ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸
                document.getElementById('previewStudentInfo').textContent = 
                    this.appState.studentInfo || 'ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                
                // ë§ˆë²• ì£¼ë¬¸ ì—…ë°ì´íŠ¸
                document.getElementById('previewMagicWord1').textContent = 
                    this.appState.magicWords[0] || 'ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                document.getElementById('previewMagicWord2').textContent = 
                    this.appState.magicWords[1] || 'ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                document.getElementById('previewMagicWord3').textContent = 
                    this.appState.magicWords[2] || 'ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                
                // ë¹„ë°€ í–‰ë™ ì—…ë°ì´íŠ¸
                document.getElementById('previewSecretAction1').textContent = 
                    this.appState.secretActions[0] || 'ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                document.getElementById('previewSecretAction2').textContent = 
                    this.appState.secretActions[1] || 'ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                document.getElementById('previewSecretAction3').textContent = 
                    this.appState.secretActions[2] || 'ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                
                // ìµœì¢… ì•½ì† ì—…ë°ì´íŠ¸
                document.getElementById('previewFinalPromise').textContent = 
                    this.appState.finalPromise || 'ì…ë ¥í•˜ì§€ ì•ŠìŒ';
                
                // ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
                this.updatePreviewImage('magicWord');
                this.updatePreviewImage('secretAction');
                this.updatePreviewImage('promise');
            }

            updatePreviewImage(imageType) {
                const previewImg = document.getElementById(`preview${imageType.charAt(0).toUpperCase() + imageType.slice(1)}Image`);
                
                if (this.appState.images[imageType]) {
                    previewImg.src = this.appState.images[imageType];
                    previewImg.style.display = 'block';
                } else {
                    previewImg.style.display = 'none';
                }
            }

            togglePreview() {
                this.updatePreview();
                
                if (this.elements.previewAreaContainer.style.display === 'none') {
                    this.elements.previewAreaContainer.style.display = 'block';
                    this.elements.previewAreaContainer.scrollIntoView({ behavior: 'smooth' });
                } else {
                    this.elements.previewAreaContainer.style.display = 'none';
                }
            }

            generateFileName(baseName, extension) {
                const studentInfo = this.appState.studentInfo.trim();
                let studentName = 'í•™ìƒ';
                
                if (studentInfo) {
                    const nameMatch = studentInfo.match(/([ê°€-í£]+)$/);
                    if (nameMatch && nameMatch[1]) {
                        studentName = nameMatch[1];
                    }
                }
                
                const timestamp = new Date().toISOString().slice(0,10).replace(/-/g,'');
                return `${baseName}_${studentName}_${timestamp}.${extension}`;
            }

            showLoading() { 
                this.elements.loadingIndicator.style.display = 'block'; 
            }

            hideLoading() { 
                this.elements.loadingIndicator.style.display = 'none'; 
            }

            async saveAsImage() {
                if (typeof html2canvas === 'undefined') {
                    alert('ì˜¤ë¥˜: html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); 
                    return;
                }
                
                try {
                    this.showLoading();
                    this.updatePreview();

                    const initiallyHidden = this.elements.previewAreaContainer.style.display === 'none';
                    if (initiallyHidden) this.elements.previewAreaContainer.style.display = 'block';

                    const canvas = await html2canvas(this.elements.previewArea, { 
                        scale: 2, 
                        useCORS: true, 
                        logging: false, 
                        backgroundColor: '#ffffff' 
                    });
                    
                    if (initiallyHidden) this.elements.previewAreaContainer.style.display = 'none';
                    
                    const image = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.download = this.generateFileName('ì¹œêµ¬ìƒ‰ê¹”ì°¾ê¸°_ë¹„ë°€ì‘ì „', 'png');
                    link.href = image;
                    link.click();
                } catch (err) {
                    console.error('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', err);
                    alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    this.hideLoading();
                }
            }

            async saveAsPdf() {
                if (typeof html2canvas === 'undefined' || typeof jspdf === 'undefined') {
                    alert('ì˜¤ë¥˜: í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); 
                    return;
                }
                
                try {
                    this.showLoading();
                    this.updatePreview();
                    
                    const initiallyHidden = this.elements.previewAreaContainer.style.display === 'none';
                    if (initiallyHidden) this.elements.previewAreaContainer.style.display = 'block';

                    const { jsPDF } = jspdf;
                    const canvas = await html2canvas(this.elements.previewArea, { 
                        scale: 2, 
                        useCORS: true, 
                        logging: false, 
                        backgroundColor: '#ffffff' 
                    });
                    
                    if (initiallyHidden) this.elements.previewAreaContainer.style.display = 'none';
                    
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                    
                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfPageWidth = pdf.internal.pageSize.getWidth();
                    const pdfPageHeight = pdf.internal.pageSize.getHeight();
                    const margin = 10;
                    const usableWidth = pdfPageWidth - (margin * 2);
                    const usableHeight = pdfPageHeight - (margin * 2);
                    const aspectRatio = imgProps.width / imgProps.height;
                    
                    let finalImgWidth = usableWidth;
                    let finalImgHeight = finalImgWidth / aspectRatio;

                    if (finalImgHeight > usableHeight) {
                        finalImgHeight = usableHeight;
                        finalImgWidth = finalImgHeight * aspectRatio;
                    }
                    
                    const x = (pdfPageWidth - finalImgWidth) / 2;
                    const y = (pdfPageHeight - finalImgHeight) / 2;

                    pdf.addImage(imgData, 'PNG', x, y, finalImgWidth, finalImgHeight);
                    pdf.save(this.generateFileName('ì¹œêµ¬ìƒ‰ê¹”ì°¾ê¸°_ë¹„ë°€ì‘ì „', 'pdf'));
                } catch (err) {
                    console.error('PDF ì €ì¥ ì¤‘ ì˜¤ë¥˜:', err);
                    alert('PDF ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    this.hideLoading();
                }
            }

            printCard() {
                this.updatePreview();
                
                const printContent = `
                    <div style="font-family: 'Noto Sans KR', sans-serif; padding: 20px; max-width: 600px; margin: 0 auto;">
                        <h1 style="text-align: center; color: #667eea; margin-bottom: 30px; font-size: 24px;">
                            ğŸŒŸ ë‚˜ì˜ ì¹œêµ¬ ìƒ‰ê¹” ì°¾ì•„ì£¼ê¸° ë¹„ë°€ì‘ì „ ì™„ë£Œ! ğŸŒŸ
                        </h1>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 3px solid #667eea;">
                            <h3 style="color: #2c3e50; margin: 0 0 15px 0;">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h3>
                            <p><strong>í•™êµ, í•™ë°˜, ì´ë¦„:</strong> ${this.appState.studentInfo || 'ë¯¸ì…ë ¥'}</p>
                        </div>
                        
                        <div style="background: #f0f4ff; padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 3px solid #667eea;">
                            <h3 style="color: #667eea; margin: 0 0 15px 0;">ğŸª„ ì¹œêµ¬ì—ê²Œ í˜ì„ ì£¼ëŠ” ë§ˆë²• ì£¼ë¬¸</h3>
                            <p>1. ${this.appState.magicWords[0] || 'ë¯¸ì…ë ¥'}</p>
                            <p>2. ${this.appState.magicWords[1] || 'ë¯¸ì…ë ¥'}</p>
                            <p>3. ${this.appState.magicWords[2] || 'ë¯¸ì…ë ¥'}</p>
                        </div>
                        
                        <div style="background: #e8f5e8; padding: 20px; border-radius: 15px; margin-bottom: 25px; border: 3px solid #11998e;">
                            <h3 style="color: #11998e; margin: 0 0 15px 0;">ğŸ•µï¸ ì¹œêµ¬ë¥¼ ì›ƒê²Œ í•˜ëŠ” ë¹„ë°€ í–‰ë™</h3>
                            <p>1. ${this.appState.secretActions[0] || 'ë¯¸ì…ë ¥'}</p>
                            <p>2. ${this.appState.secretActions[1] || 'ë¯¸ì…ë ¥'}</p>
                            <p>3. ${this.appState.secretActions[2] || 'ë¯¸ì…ë ¥'}</p>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #fef7cd, #fff8dc); padding: 25px; border-radius: 15px; border: 4px solid #d4a574; text-align: center;">
                            <h3 style="color: #8b4513; margin: 0 0 20px 0;">ğŸ“œ ë‚˜ì˜ ì†Œì¤‘í•œ ì•½ì† ğŸ“œ</h3>
                            <p style="font-size: 18px; font-weight: bold; color: #8b4513; line-height: 1.8; margin: 0;">
                                "${this.appState.finalPromise || 'ë¯¸ì…ë ¥'}"
                            </p>
                        </div>
                        
                        <p style="text-align: center; margin-top: 30px; color: #6b7280; font-size: 14px;">
                            ğŸŠ ì™„ì„±ì¼: ${new Date().toLocaleDateString('ko-KR')} ğŸŠ
                        </p>
                    </div>
                `;
                
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>ë‚˜ì˜ ì¹œêµ¬ ìƒ‰ê¹” ì°¾ì•„ì£¼ê¸° ë¹„ë°€ì‘ì „ ì¹´ë“œ</title>
                        <meta charset="UTF-8">
                        <style>
                            body { margin: 0; padding: 20px; font-family: 'Noto Sans KR', sans-serif; }
                            @media print { 
                                body { -webkit-print-color-adjust: exact; color-adjust: exact; } 
                            }
                        </style>
                    </head>
                    <body>
                        ${printContent}
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }

            saveData() {
                try {
                    const dataToSave = {
                        ...this.appState,
                        currentStep: this.currentStep,
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem('friendshipMissionData', JSON.stringify(dataToSave));
                } catch (error) {
                    console.warn('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
                }
            }

            loadSavedData() {
                try {
                    const savedData = localStorage.getItem('friendshipMissionData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        
                        // ê¸°ë³¸ ì •ë³´ ë³µì›
                        this.elements.studentInfo.value = data.studentInfo || '';
                        
                        // ë§ˆë²• ì£¼ë¬¸ ë³µì›
                        if (data.magicWords) {
                            this.elements.magicWord1.value = data.magicWords[0] || '';
                            this.elements.magicWord2.value = data.magicWords[1] || '';
                            this.elements.magicWord3.value = data.magicWords[2] || '';
                        }
                        
                        // ë¹„ë°€ í–‰ë™ ë³µì›
                        if (data.secretActions) {
                            this.elements.secretAction1.value = data.secretActions[0] || '';
                            this.elements.secretAction2.value = data.secretActions[1] || '';
                            this.elements.secretAction3.value = data.secretActions[2] || '';
                        }
                        
                        // ìµœì¢… ì•½ì† ë³µì›
                        this.elements.finalPromise.value = data.finalPromise || '';
                        
                        // ì´ë¯¸ì§€ ë³µì›
                        if (data.images) {
                            Object.keys(data.images).forEach(imageType => {
                                if (data.images[imageType]) {
                                    this.appState.images[imageType] = data.images[imageType];
                                    this.updateImagePreview(imageType, data.images[imageType]);
                                }
                            });
                        }
                        
                        this.updateAppState();
                    }
                } catch (error) {
                    console.warn('ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', error);
                }
            }

            resetAll() {
                if (confirm('ëª¨ë“  ì…ë ¥ ë‚´ìš©ì´ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    // ëª¨ë“  ì…ë ¥ ì´ˆê¸°í™”
                    Object.values(this.elements).forEach(element => {
                        if (element && (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA')) {
                            element.value = '';
                        }
                    });
                    
                    // ì´ë¯¸ì§€ ì´ˆê¸°í™”
                    this.clearImage('magicWord');
                    this.clearImage('secretAction');
                    this.clearImage('promise');
                    
                    // ìƒíƒœ ì´ˆê¸°í™”
                    this.appState = {
                        studentInfo: '',
                        magicWords: ['', '', ''],
                        secretActions: ['', '', ''],
                        finalPromise: '',
                        images: {
                            magicWord: null,
                            secretAction: null,
                            promise: null
                        }
                    };
                    
                    // í”¼ë“œë°± ìˆ¨ê¹€
                    document.querySelectorAll('.input-feedback').forEach(feedback => {
                        feedback.style.display = 'none';
                    });
                    
                    // ì™„ë£Œ ë©”ì‹œì§€ ìˆ¨ê¹€
                    document.getElementById('completionMessage').style.display = 'none';
                    
                    // ì²« ë²ˆì§¸ ë‹¨ê³„ë¡œ ëŒì•„ê°€ê¸°
                    this.goToStep(1);
                    this.elements.previewAreaContainer.style.display = 'none';
                    
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”
                    localStorage.removeItem('friendshipMissionData');
                    
                    alert('ëª¨ë“  ë‚´ìš©ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ë¹„ë°€ ì‘ì „ì„ ì‹œì‘í•´ë³´ì„¸ìš”! ğŸŒŸ');
                }
            }
        }

        // ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            new FriendshipMissionApp();
        });
    </script>
</body>
</html>